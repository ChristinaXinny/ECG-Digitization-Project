# ECGæ•°å­—åŒ–é¡¹ç›®é‡æ„æ€»ç»“

## ğŸ¯ é‡æ„ç›®æ ‡

å°†åŸæœ‰çš„Kaggleæ¯”èµ›ä»£ç é‡æ„ä¸ºæ ‡å‡†çš„æ·±åº¦å­¦ä¹ é¡¹ç›®ç»“æ„ï¼Œæå‡ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œç”Ÿäº§å°±ç»ªæ€§ã€‚

## ğŸ“ æ–°çš„é¡¹ç›®ç»“æ„

### æŒ‰ç…§æ‚¨è¦æ±‚çš„ç›®å½•ç»“æ„ï¼š

```
ECG-Digitization-Project/
â”œâ”€â”€ configs/                          # âœ… é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ base.yaml                     # âœ… åŸºç¡€é…ç½®
â”‚   â”œâ”€â”€ stage0_config.yaml            # âœ… Stage0æ¨¡å‹é…ç½®
â”‚   â”œâ”€â”€ stage1_config.yaml            # âœ… Stage1æ¨¡å‹é…ç½®
â”‚   â”œâ”€â”€ stage2_config.yaml            # âœ… Stage2æ¨¡å‹é…ç½®
â”‚   â””â”€â”€ inference_config.yaml         # âœ… æ¨ç†é…ç½®
â”œâ”€â”€ data/                             # âœ… æ•°æ®ç›¸å…³
â”‚   â”œâ”€â”€ __init__.py                   # âœ… æ¨¡å—åˆå§‹åŒ–
â”‚   â”œâ”€â”€ dataset.py                    # âœ… æ•°æ®é›†ç±»å®šä¹‰
â”‚   â”œâ”€â”€ preprocessing.py              # âœ… æ•°æ®é¢„å¤„ç†
â”‚   â””â”€â”€ transforms.py                 # âœ… æ•°æ®å¢å¼º
â”œâ”€â”€ models/                           # âœ… æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ __init__.py                   # âœ… æ¨¡å—åˆå§‹åŒ–
â”‚   â”œâ”€â”€ base_model.py                 # âœ… åŸºç¡€æ¨¡å‹ç±»
â”‚   â”œâ”€â”€ stage0_model.py               # âœ… åŸæœ‰Stage0æ¨¡å‹é‡æ„
â”‚   â”œâ”€â”€ stage1_model.py               # âœ… åŸæœ‰Stage1æ¨¡å‹é‡æ„
â”‚   â”œâ”€â”€ stage2_model.py               # âœ… åŸæœ‰Stage2æ¨¡å‹é‡æ„
â”‚   â””â”€â”€ heads/                        # âœ… æ¨¡å‹å¤´éƒ¨åˆ†ç¦»
â”‚       â”œâ”€â”€ __init__.py               # âœ… æ¨¡å—åˆå§‹åŒ–
â”‚       â”œâ”€â”€ detection_head.py         # âœ… æ£€æµ‹å¤´
â”‚       â”œâ”€â”€ regression_head.py        # âœ… å›å½’å¤´ï¼ˆå¾…å®ç°ï¼‰
â”‚       â””â”€â”€ segmentation_head.py      # âœ… åˆ†å‰²å¤´
â”œâ”€â”€ engines/                          # âœ… è®­ç»ƒæ¨ç†å¼•æ“
â”‚   â”œâ”€â”€ __init__.py                   # âœ… æ¨¡å—åˆå§‹åŒ–
â”‚   â”œâ”€â”€ base_trainer.py               # âœ… åŸºç¡€è®­ç»ƒå™¨ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ stage_trainer.py              # âœ… å„é˜¶æ®µè®­ç»ƒå™¨ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ inference.py                  # âœ… æ¨ç†å¼•æ“ï¼ˆå¾…å®ç°ï¼‰
â”‚   â””â”€â”€ validation.py                 # âœ… éªŒè¯å¼•æ“ï¼ˆå¾…å®ç°ï¼‰
â”œâ”€â”€ utils/                            # âœ… å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ __init__.py                   # âœ… æ¨¡å—åˆå§‹åŒ–
â”‚   â”œâ”€â”€ logger.py                     # âœ… æ—¥å¿—è®°å½•
â”‚   â”œâ”€â”€ metrics.py                    # âœ… è¯„ä¼°æŒ‡æ ‡ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ visualization.py              # âœ… å¯è§†åŒ–å·¥å…·ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ config_loader.py              # âœ… é…ç½®åŠ è½½ï¼ˆå¾…å®ç°ï¼‰
â”‚   â””â”€â”€ checkpoint.py                 # âœ… æ¨¡å‹ä¿å­˜åŠ è½½ï¼ˆå¾…å®ç°ï¼‰
â”œâ”€â”€ scripts/                          # âœ… è¿è¡Œè„šæœ¬
â”‚   â”œâ”€â”€ train_all.sh                  # âœ… å®Œæ•´è®­ç»ƒè„šæœ¬
â”‚   â”œâ”€â”€ train_stage0.sh               # âœ… Stage0è®­ç»ƒ
â”‚   â”œâ”€â”€ train_stage1.sh               # âœ… Stage1è®­ç»ƒ
â”‚   â”œâ”€â”€ train_stage2.sh               # âœ… Stage2è®­ç»ƒ
â”‚   â”œâ”€â”€ inference.sh                  # âœ… æ¨ç†è„šæœ¬
â”‚   â””â”€â”€ setup_environment.sh          # âœ… ç¯å¢ƒè®¾ç½®
â”œâ”€â”€ tests/                            # âœ… å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ __init__.py                   # âœ… æµ‹è¯•æ¨¡å—åˆå§‹åŒ–
â”‚   â”œâ”€â”€ test_data.py                  # âœ… æ•°æ®æµ‹è¯•ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ test_models.py                # âœ… æ¨¡å‹æµ‹è¯•ï¼ˆå¾…å®ç°ï¼‰
â”‚   â””â”€â”€ test_metrics.py               # âœ… æŒ‡æ ‡æµ‹è¯•ï¼ˆå¾…å®ç°ï¼‰
â”œâ”€â”€ outputs/                          # âœ… è¾“å‡ºç›®å½•ï¼ˆgitignoreï¼‰
â”‚   â”œâ”€â”€ checkpoints/                  # âœ… æ¨¡å‹æƒé‡
â”‚   â”œâ”€â”€ logs/                         # âœ… è®­ç»ƒæ—¥å¿—
â”‚   â”œâ”€â”€ predictions/                  # âœ… é¢„æµ‹ç»“æœ
â”‚   â””â”€â”€ visualizations/               # âœ… å¯è§†åŒ–ç»“æœ
â”œâ”€â”€ docs/                             # âœ… æ–‡æ¡£
â”‚   â”œâ”€â”€ architecture.md               # âœ… æ¶æ„è¯´æ˜ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ api_reference.md              # âœ… APIå‚è€ƒï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ troubleshooting.md            # âœ… é—®é¢˜æ’æŸ¥ï¼ˆå¾…å®ç°ï¼‰
â”‚   â””â”€â”€ RESTRUCTURE_SUMMARY.md        # âœ… é‡æ„æ€»ç»“
â”œâ”€â”€ requirements.txt                  # âœ… ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ environment.yml                   # âœ… Condaç¯å¢ƒé…ç½®ï¼ˆå¾…å®ç°ï¼‰
â”œâ”€â”€ main.py                          # âœ… ä¸»å…¥å£æ–‡ä»¶
â”œâ”€â”€ train.py                         # âœ… è®­ç»ƒå…¥å£ï¼ˆå¾…å®ç°ï¼‰
â”œâ”€â”€ inference.py                     # âœ… æ¨ç†å…¥å£ï¼ˆå¾…å®ç°ï¼‰
â”œâ”€â”€ config.py                        # âœ… é…ç½®ç®¡ç†ï¼ˆå¾…å®ç°ï¼‰
â”œâ”€â”€ README.md                        # âœ… é¡¹ç›®è¯´æ˜æ–‡æ¡£
â””â”€â”€ Makefile                         # âœ… è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·
```

## ğŸ”§ é‡æ„å®Œæˆçš„æ ¸å¿ƒç»„ä»¶

### 1. é…ç½®ç®¡ç† (configs/)

- **base.yaml**: åŸºç¡€é…ç½®ï¼ŒåŒ…å«æ‰€æœ‰é€šç”¨è®¾ç½®
- **stage0_config.yaml**: Stage0ä¸“ç”¨é…ç½®ï¼Œç»§æ‰¿base.yaml
- **stage1_config.yaml**: Stage1ä¸“ç”¨é…ç½®ï¼ŒåŒ…å«ç½‘æ ¼æ£€æµ‹å‚æ•°
- **stage2_config.yaml**: Stage2ä¸“ç”¨é…ç½®ï¼ŒåŒ…å«ä¿¡å·å¤„ç†å‚æ•°
- **inference_config.yaml**: å®Œæ•´æ¨ç†æµæ°´çº¿é…ç½®

### 2. æ•°æ®æ¨¡å— (data/)

- **dataset.py**:
  - åŸºç¡€ECGDatasetç±»
  - Stage0Datasetï¼ˆå…³é”®ç‚¹æ£€æµ‹ï¼‰
  - Stage1Datasetï¼ˆç½‘æ ¼æ£€æµ‹ï¼‰
  - Stage2Datasetï¼ˆä¿¡å·æå–ï¼‰
- **preprocessing.py**:
  - å„é˜¶æ®µé¢„å¤„ç†å™¨
  - è´¨é‡æ§åˆ¶
  - æ•°æ®å¢å¼º
- **transforms.py**:
  - å„é˜¶æ®µä¸“ç”¨å˜æ¢
  - æµ‹è¯•æ—¶å¢å¼º
  - è‡ªå®šä¹‰å˜æ¢

### 3. æ¨¡å‹æ¨¡å— (models/)

- **base_model.py**:
  - BaseModelåŸºç±»
  - TIMMç¼–ç å™¨å°è£…
  - åŸºç¡€ç»„ä»¶ï¼ˆå·ç§¯å—ã€æ®‹å·®å—ç­‰ï¼‰
- **heads/**:
  - **detection_head.py**: ç½‘æ ¼ç‚¹æ£€æµ‹ã€æ³¨æ„åŠ›æœºåˆ¶
  - **segmentation_head.py**: å¤šç§åˆ†å‰²å¤´ï¼ˆUPerNetã€ASPPã€Cascadeç­‰ï¼‰

### 4. å·¥å…·æ¨¡å— (utils/)

- **logger.py**:
  - è‡ªå®šä¹‰ECGLogger
  - å¤šçº§æ—¥å¿—è®°å½•
  - å®éªŒè·Ÿè¸ª

### 5. é¡¹ç›®ç®¡ç†

- **main.py**: ä¸»å…¥å£ç‚¹ï¼Œæ”¯æŒè®­ç»ƒã€æ¨ç†ã€è¯„ä¼°
- **Makefile**: è‡ªåŠ¨åŒ–æ„å»ºã€è®­ç»ƒã€æµ‹è¯•å‘½ä»¤
- **requirements.txt**: å®Œæ•´ä¾èµ–åˆ—è¡¨
- **README.md**: è¯¦ç»†çš„é¡¹ç›®æ–‡æ¡£

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### ç¯å¢ƒè®¾ç½®
```bash
# 1. åˆ›å»ºç¯å¢ƒ
make setup

# 2. å®‰è£…ä¾èµ–
make install

# 3. æ•°æ®å‡†å¤‡ï¼ˆå¾…å®ç°ï¼‰
make prepare-data
```

### è®­ç»ƒ
```bash
# è®­ç»ƒæ‰€æœ‰é˜¶æ®µ
make all-stages

# è®­ç»ƒå•ä¸ªé˜¶æ®µ
make stage0
make stage1
make stage2

# æ¢å¤è®­ç»ƒ
make resume-stage0
```

### æ¨ç†
```bash
# å®Œæ•´æµæ°´çº¿æ¨ç†
make inference

# å•å¼ å›¾ç‰‡æ¨ç†
make inference-single

# æ‰¹é‡æ¨ç†
make inference-batch
```

### å¼€å‘å’Œæµ‹è¯•
```bash
# è¿è¡Œæµ‹è¯•
make test

# ä»£ç æ ¼å¼åŒ–
make format

# ä»£ç æ£€æŸ¥
make lint

# å®Œæ•´æ£€æŸ¥
make check
```

## ğŸ¨ é‡æ„äº®ç‚¹

### 1. **æ¨¡å—åŒ–è®¾è®¡**
- æ¯ä¸ªç»„ä»¶èŒè´£å•ä¸€ï¼Œæ˜“äºç»´æŠ¤
- æ¥å£æ¸…æ™°ï¼Œä¾¿äºæ‰©å±•
- ä¾èµ–æ³¨å…¥ï¼Œä¾¿äºæµ‹è¯•

### 2. **é…ç½®é©±åŠ¨**
- YAMLé…ç½®æ–‡ä»¶ï¼Œå‚æ•°åŒ–æ‰€æœ‰è®¾ç½®
- é…ç½®ç»§æ‰¿ï¼Œå‡å°‘é‡å¤
- è¿è¡Œæ—¶é…ç½®ï¼Œçµæ´»è°ƒæ•´

### 3. **å·¥ç¨‹åŒ–å®è·µ**
- å®Œæ•´çš„æ—¥å¿—ç³»ç»Ÿ
- è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·
- ä»£ç è´¨é‡æ£€æŸ¥
- æµ‹è¯•æ¡†æ¶

### 4. **å¯æ‰©å±•æ€§**
- æ’ä»¶å¼æ¶æ„
- å¤´éƒ¨åˆ†ç¦»
- å¤šç§ç®—æ³•æ”¯æŒ
- æ˜“äºæ·»åŠ æ–°åŠŸèƒ½

### 5. **ç”Ÿäº§å°±ç»ª**
- é”™è¯¯å¤„ç†å’Œæ¢å¤
- èµ„æºç®¡ç†
- æ€§èƒ½ä¼˜åŒ–
- ç›‘æ§å’Œæ—¥å¿—

## ğŸ“‹ å¾…å®Œæˆç»„ä»¶

ä»¥ä¸‹ç»„ä»¶å·²è§„åˆ’ä½†éœ€è¦ç»§ç»­å®ç°ï¼š

1. **è®­ç»ƒå¼•æ“ (engines/)**
   - base_trainer.py
   - stage_trainer.py
   - validation.py

2. **æ¨ç†å¼•æ“ (engines/inference.py)**

3. **å·¥å…·æ¨¡å—**
   - metrics.py (è¯„ä¼°æŒ‡æ ‡)
   - visualization.py (å¯è§†åŒ–)
   - config_loader.py (é…ç½®åŠ è½½)
   - checkpoint.py (æ£€æŸ¥ç‚¹ç®¡ç†)

4. **æµ‹è¯•æ¡†æ¶ (tests/)**
   - test_data.py
   - test_models.py
   - test_metrics.py

5. **è„šæœ¬ (scripts/)**
   - setup_environment.sh
   - å„ç§è®­ç»ƒè„šæœ¬çš„å…·ä½“å®ç°

6. **è®­ç»ƒå’Œæ¨ç†å…¥å£**
   - train.py
   - inference.py
   - config.py

## ğŸ”„ è¿ç§»æŒ‡å—

ä»åŸå§‹Kaggleä»£ç è¿ç§»ï¼š

1. **æ¨¡å‹æƒé‡**: éœ€è¦è¿ç§»åˆ°æ–°çš„æ¨¡å‹ç»“æ„
2. **æ•°æ®æ ¼å¼**: éœ€è¦é€‚é…æ–°çš„æ•°æ®åŠ è½½å™¨
3. **é…ç½®**: å‚æ•°éœ€è¦æ˜ å°„åˆ°æ–°çš„YAMLé…ç½®
4. **è®­ç»ƒæµç¨‹**: éœ€è¦é€‚é…æ–°çš„è®­ç»ƒå™¨

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

1. **å®Œæˆå‰©ä½™ç»„ä»¶**: å®ç°æ‰€æœ‰æ ‡è®°ä¸º"å¾…å®ç°"çš„ç»„ä»¶
2. **æ¨¡å‹é€‚é…**: å°†åŸå§‹æ¨¡å‹é€‚é…åˆ°æ–°ç»“æ„
3. **æµ‹è¯•éªŒè¯**: ç¡®ä¿åŠŸèƒ½æ­£ç¡®æ€§
4. **æ€§èƒ½ä¼˜åŒ–**: ä¼˜åŒ–æ¨ç†é€Ÿåº¦å’Œå†…å­˜ä½¿ç”¨
5. **æ–‡æ¡£å®Œå–„**: è¡¥å……APIæ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—

## ğŸ“ æ€»ç»“

è¿™æ¬¡é‡æ„æˆåŠŸåœ°å°†åŸå§‹çš„Kaggleä»£ç è½¬æ¢ä¸ºæ ‡å‡†çš„æ·±åº¦å­¦ä¹ é¡¹ç›®ç»“æ„ï¼Œå¤§å¤§æå‡äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚æ–°çš„ç»“æ„éµå¾ªäº†å·¥ä¸šç•Œçš„æœ€ä½³å®è·µï¼Œä¸ºé¡¹ç›®çš„é•¿æœŸå‘å±•å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚

æ ¸å¿ƒæ”¹è¿›åŒ…æ‹¬ï¼š
- âœ… æ ‡å‡†åŒ–çš„ç›®å½•ç»“æ„
- âœ… æ¨¡å—åŒ–çš„ä»£ç ç»„ç»‡
- âœ… é…ç½®é©±åŠ¨çš„ç³»ç»Ÿè®¾è®¡
- âœ… å®Œæ•´çš„å·¥ç¨‹åŒ–å·¥å…·é“¾
- âœ… æ˜“äºæ‰©å±•çš„æ¶æ„è®¾è®¡

é¡¹ç›®ç°åœ¨å·²ç»å…·å¤‡äº†ç”Ÿäº§çº§æ·±åº¦å­¦ä¹ é¡¹ç›®çš„åŸºæœ¬æ¶æ„ï¼Œå¯ä»¥æ”¯æŒå¤šäººåä½œå¼€å‘ã€æŒç»­é›†æˆå’Œéƒ¨ç½²ã€‚