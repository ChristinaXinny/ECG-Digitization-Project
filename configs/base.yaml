# Base Configuration for ECG Digitization Project

# Project Information
PROJECT_NAME: "ECG Digitization"
VERSION: "1.0.0"
SEED: 42
DESCRIPTION: "ECG Image to Digital Signal Conversion"

# Device Configuration
DEVICE:
  DEVICE: "cuda"  # cuda, cpu
  GPU_IDS: [0]
  NUM_WORKERS: 4
  PIN_MEMORY: True
  MIXED_PRECISION: True
  AMP_ENABLED: True

# Training Configuration
TRAIN:
  BATCH_SIZE: 4
  EPOCHS: 100
  LEARNING_RATE: 1e-4
  WEIGHT_DECAY: 1e-5
  GRADIENT_CLIP: 1.0

  OPTIMIZER:
    NAME: "AdamW"
    BETAS: [0.9, 0.999]
    EPS: 1e-8

  SCHEDULER:
    NAME: "CosineAnnealingLR"
    MIN_LR: 1e-6
    WARMUP_EPOCHS: 5

  LOSS_WEIGHTS:
    DETECTION: 1.0
    CLASSIFICATION: 1.0
    REGRESSION: 1.0

  AUGMENTATION:
    H_FLIP: 0.0
    V_FLIP: 0.0
    ROTATION: 5.0
    BRIGHTNESS: 0.2
    CONTRAST: 0.2
    GAUSSIAN_NOISE: 0.1

# Validation Configuration
VALID:
  BATCH_SIZE: 8
  SAVE_IMAGES: True
  NUM_VISUALIZATIONS: 5
  EVAL_INTERVAL: 1

# Data Configuration
DATA:
  IMG_SIZE: [1152, 1440]  # [H, W] for stages 0,1
  CROP_SIZE: [1696, 2176]  # [H, W] for stage 2

  NORMALIZE:
    MEAN: [0.485, 0.456, 0.406]
    STD: [0.229, 0.224, 0.225]

  ECG_CONFIG:
    NUM_LEADS: 12
    LEAD_NAMES: ['I', 'II', 'III', 'aVR', 'aVL', 'aVF', 'V1', 'V2', 'V3', 'V4', 'V5', 'V6']
    SAMPLING_RATE: 500
    TIME_WINDOW: 10

  GRID_CONFIG:
    H_LINES: 44
    V_LINES: 57
    MV_TO_PIXEL: 79.0
    ZERO_MV: [703.5, 987.5, 1271.5, 1531.5]

  LEAD_LABELS:
    'None': 0, 'I': 1, 'aVR': 2, 'V1': 3, 'V4': 4,
    'II': 5, 'aVL': 6, 'V2': 7, 'V5': 8,
    'III': 9, 'aVF': 10, 'V3': 11, 'V6': 12,
    'II-rhythm': 13

# Model Configuration
MODEL:
  BACKBONE:
    NAME: "resnet18d"
    PRETRAINED: True
    IN_CHANNELS: 3

  DECODER:
    HIDDEN_DIMS: [256, 128, 64, 32]
    SCALE_FACTORS: [2, 2, 2, 2]

  COORDINATE_ENCODING:
    ENABLED: True
    COORD_RANGE: [-2, 2]

# Logging Configuration
LOG:
  LEVEL: "INFO"
  LOG_DIR: "outputs/logs"
  TENSORBOARD: True
  WANDB:
    ENABLED: False
    PROJECT: "ecg-digitization"
    ENTITY: null

# Checkpoint Configuration
CHECKPOINT:
  SAVE_DIR: "outputs/checkpoints"
  SAVE_TOP_K: 3
  SAVE_LAST: True
  MONITOR: "val_loss"
  MODE: "min"

# Inference Configuration
INFERENCE:
  BATCH_SIZE: 1
  ENSEMBLE: False
  TTA: False
  CONFIDENCE_THRESHOLD: 0.5

  STAGE_CONFIGS:
    STAGE0:
      MARKER_THRESHOLD: 0.5
      ORIENTATION_THRESHOLD: 0.8
    STAGE1:
      GRIDPOINT_THRESHOLD: 0.5
      GRIDLINE_THRESHOLD: 0.3
    STAGE2:
      PIXEL_THRESHOLD: 0.4

# Paths Configuration
PATHS:
  DATA_ROOT: "../ecg_data"
  WEIGHTS_ROOT: "./outputs/checkpoints"
  OUTPUT_ROOT: "./outputs"
  CACHE_ROOT: "./cache"

  STAGE_WEIGHTS:
    STAGE0: "stage0-last.checkpoint.pth"
    STAGE1: "stage1-last.checkpoint.pth"
    STAGE2: "stage2-00005810.checkpoint.pth"

# Experiment Configuration
EXPERIMENT:
  NAME: "baseline"
  TAGS: ["baseline", "ecg-digitization"]
  NOTES: "Baseline experiment for ECG digitization"

# Competition Configuration
COMPETITION:
  MODE: "local"  # submit, local, fake
  KAGGLE_DIR: "../ecg_data/physionet-ecg-image-digitization"
  WEIGHT_DIR: "./outputs/checkpoints"
  OUTPUT_DIR: "./outputs"

# Quality Control
QUALITY_CONTROL:
  ENABLED: True
  MIN_CONFIDENCE: 0.5
  MAX_FAILURES: 10

  STAGE0:
    MIN_KEYPOINT_CONFIDENCE: 0.6
    MIN_ORIENTATION_CONFIDENCE: 0.8
  STAGE1:
    MIN_GRID_DETECTION_SCORE: 0.3
    MAX_RECTIFICATION_ERROR: 20.0
  STAGE2:
    MIN_SIGNAL_AMPLITUDE: 0.1
    MIN_SIGNAL_SNR: 3.0

# Debug Configuration
DEBUG:
  ENABLED: False
  SAVE_INTERMEDIATE: True
  VISUALIZE: True
  PROFILING: False